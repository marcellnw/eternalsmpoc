<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pendaftaran Karakter OC - EternalSMP</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&display=swap" rel="stylesheet">
  <style>
    :root {
      --gold: #ffd700;
      --dark: #000;
      --text: #fff;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--dark);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    header {
      background: #111;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 2px solid var(--gold);
    }
    .logo {
      font-family: 'Cinzel', serif;
      font-size: 24px;
      color: var(--gold);
    }
    .back-btn {
      background: transparent;
      border: 1px solid var(--gold);
      color: var(--gold);
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .container {
      max-width: 960px;
      width: 100%;
      margin: 24px auto;
      background: #111;
      border: 1px solid var(--gold);
      border-radius: 12px;
      padding: 24px;
    }
    h2 {
      font-family: 'Cinzel', serif;
      text-align: center;
      margin-bottom: 24px;
      font-size: 24px;
      color: var(--gold);
    }
    .form-columns {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
    }
    .form-left, .form-right {
      flex: 1 1 300px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    label {
      font-weight: bold;
      color: var(--gold);
    }
    input, select, textarea {
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #666;
      font-size: 14px;
      background: #222;
      color: #fff;
      width: 100%;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    .btn-group {
      text-align: center;
      margin-top: 24px;
    }
    button.btn {
      background: var(--gold);
      border: none;
      color: #000;
      padding: 8px 16px;
      margin: 6px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
    }
    footer {
      background: #000;
      color: #999;
      text-align: center;
      padding: 20px;
      margin-top: auto;
      border-top: 1px solid var(--gold);
    }
    footer .social {
      margin-top: 8px;
      list-style: none;
      display: flex;
      justify-content: center;
      gap: 12px;
    }
    footer .social li a {
      color: var(--gold);
      font-size: 18px;
    }
  </style>
</head>
<body>
  <!-- 🔈 Suara Klik -->
  <audio id="clickSound" src="click.mp3" preload="auto"></audio>
  <audio id="Click2Sound" src="click2.mp3" preload="auto"></audio>

  <header>
    <div class="logo">EternalSMP</div>
    <button class="back-btn" onclick="playClick2(); window.location.href='index.html';">Kembali</button>
  </header>

  <div class="container">
    <h2>📝 Pendaftaran Karakter OC</h2>
    <form id="ocForm">
      <div class="form-columns">
        <div class="form-left">
          <label for="gamertag">🎮 Nama Gamertag</label>
          <input type="text" id="gamertag" name="gamertag" required pattern="\w{3,16}">

          <label for="ocname">👤 Nama Karakter OC</label>
          <input type="text" id="ocname" name="ocname" required pattern="[A-Za-z\s]{3,}">

          <label for="race">🧬 Ras Karakter</label>
          <select id="race" name="race" required>
            <option value="">-- Pilih --</option>
            <option value="Euria">Euria - Peri cahaya</option>
            <option value="Graveth">Graveth - Ahli sihir gelap</option>
            <option value="Maredien">Maredien - Bangsawan diplomatis</option>
            <option value="Heretic">Heretic - Pengguna sihir terlarang</option>
            <option value="Diablonic">Diablonic - Iblis kuat</option>
            <option value="Laurian">Laurian - Pelindung hutan</option>
          </select>

          <label for="class">⚔️ Class Tempur</label>
          <select id="class" name="class" required>
            <option value="">-- Pilih --</option>
            <option>Warrior - Petarung seimbang</option>
            <option>Berserker - Liar & brutal</option>
            <option>Tank - Pertahanan tinggi</option>
            <option>Lancer - Cepat & menusuk</option>
            <option>Rogue - Licik & lincah</option>
            <option>Hunter - Jarak jauh</option>
            <option>Ronin - Pendekar bebas</option>
            <option>Swordmage - Pedang & sihir</option>
            <option>Priest - Penyembuh</option>
          </select>
        </div>

        <div class="form-right">
          <label for="job">🔨 Job / Profesi</label>
          <select id="job" name="job" required>
            <option value="">-- Pilih --</option>
            <option>Alchemist - Pembuat ramuan</option>
            <option>Blacksmith - Pandai besi</option>
            <option>Trader - Ahli jual beli</option>
            <option>Farmer - Petani</option>
            <option>Nitwit - Awal tanpa keahlian</option>
          </select>

          <label for="role">👑 Role Sosial</label>
          <select id="role" name="role" required>
            <option value="">-- Pilih --</option>
            <option>Raja - Pemimpin utama</option>
            <option>Bangsawan - Tokoh berpengaruh</option>
            <option>Royalis - Pendukung kerajaan</option>
            <option>Worker - Rakyat biasa</option>
          </select>

          <label for="image">🖼️ Upload Gambar (opsional)</label>
          <input type="file" id="image" name="image" accept="image/*">

          <label for="sifat">🎭 Sifat & Kepribadian</label>
          <textarea id="sifat" name="sifat" minlength="50" required></textarea>
        </div>
      </div>
      <!-- Lore & Tujuan -->
      <label for="lore">📖 Lore & Background Karakter</label>
      <textarea id="lore" name="lore" minlength="500" maxlength="3000" required></textarea>

      <label for="tujuan">🎯 Tujuan & Motivasi Karakter</label>
      <textarea id="tujuan" name="tujuan" minlength="100" maxlength="500" required></textarea>

      <!-- Tombol Aksi -->
<button type="button" class="btn glow-btn" onclick="playClick(); window.open('preview-oc.html', '_blank')">
  👁️ Lihat Preview
</button>
    </form>
  </div>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 Eternal SMP. All rights reserved.</p>
    <ul class="social">
      <li><a href="https://instagram.com/eternalsmp" target="_blank"><i class="fab fa-instagram"></i></a></li>
      <li><a href="https://youtube.com/@eternalsmpserver" target="_blank"><i class="fab fa-youtube"></i></a></li>
      <li><a href="https://www.tiktok.com/@eternalsmpserver" target="_blank"><i class="fab fa-tiktok"></i></a></li>
    </ul>
  </footer>
  <!-- Script -->
  <script>
    // 🔊 Suara klik
    function playClick() {
      document.getElementById("clickSound")?.play();
    }
    function playClick2() {
      document.getElementById("Click2Sound")?.play();
    }

    // 🔐 Validasi input tambahan
    function validateFormInputs() {
      const gamertag = document.querySelector("#gamertag").value.trim();
      const ocname = document.querySelector("#ocname").value.trim();
      const sifat = document.querySelector("#sifat").value.trim();
      const lore = document.querySelector("#lore").value.trim();
      const tujuan = document.querySelector("#tujuan").value.trim();

      if (!/^[\w]{3,16}$/.test(gamertag)) {
        alert("Gamertag hanya boleh huruf, angka, dan garis bawah, 3-16 karakter.");
        return false;
      }
      if (!/^[a-zA-Z\s]{3,}$/.test(ocname)) {
        alert("Nama karakter OC minimal 3 huruf dan hanya huruf/spasi.");
        return false;
      }
      if (sifat.split(/\s+/).length < 50) {
        alert("Sifat & Kepribadian minimal 50 kata.");
        return false;
      }
      if (lore.split(/\s+/).length < 300) {
        alert("Lore minimal 300 kata.");
        return false;
      }
      if (tujuan.split(/\s+/).length < 100) {
        alert("Tujuan minimal 100 kata.");
        return false;
      }

      return true;
    }

    async function submitToDiscord() {
      const form = document.getElementById("ocForm");
      const data = new FormData(form);

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      if (!validateFormInputs()) return;
      if (!confirm("Apakah kamu yakin ingin mengirim pendaftaran ini?")) return;

      const imageFile = data.get("image");
      if (imageFile && imageFile.name && !imageFile.type.startsWith("image/")) {
        alert("File yang diunggah harus berupa gambar.");
        return;
      }

      const webhook = "https://discord.com/api/webhooks/1389899055672594494/ap4v8BlHwvs8JL8RXmisbPcZDsBZBCImJfkQdawlXPKAN8Uw8rWKPLSnL7P5WOf5vDm5";

    const infoFields = [];
      let loreChunks = [], tujuanChunks = [];

      for (let [key, value] of data.entries()) {
        if (key === "image") continue;
        const text = value.trim();
        const chunks = text.match(/.{1,1024}/gs) || [];
        const emoji = {
          gamertag: "🎮", ocname: "👤", race: "🧬", class: "⚔️",
          job: "🔨", role: "👑", sifat: "🎭", lore: "📖", tujuan: "🎯"
        }[key] || "";

        const label = {
          gamertag: "Nama Gamertag", ocname: "Nama Karakter",
          race: "Ras", class: "Class", job: "Job", role: "Role Sosial",
          sifat: "Sifat & Kepribadian", lore: "Lore & Background", tujuan: "Tujuan & Motivasi"
        }[key] || key;

        const mappedChunks = chunks.map((chunk, i) => ({
          name: `${emoji} ${label}${chunks.length > 1 ? ` (${i + 1})` : ""}`,
          value: chunk,
          inline: false
        }));

        if (key === "lore") loreChunks = mappedChunks;
        else if (key === "tujuan") tujuanChunks = mappedChunks;
        else infoFields.push(mappedChunks[0]);
      }

      const embeds = [
        {
          title: "🗡️ Pendaftaran Karakter Baru",
          description: "Berikut adalah karakter OC yang baru terdaftar:",
          color: 0xFFD700,
          fields: infoFields
        },
        {
          title: "📖 Lore & Background",
          color: 0x5865F2,
          fields: loreChunks
        },
        {
          title: "🎯 Tujuan & Motivasi",
          color: 0x57F287,
          fields: tujuanChunks
        }
      ];

      try {
        let response;

        if (imageFile && imageFile.name) {
          const buffer = await imageFile.arrayBuffer();
          const blob = new Blob([buffer], { type: imageFile.type });

          const formData = new FormData();
          formData.append("file", blob, imageFile.name);
          formData.append("payload_json", JSON.stringify({
            username: "EternalSMP OC Register",
            embeds: [
              { ...embeds[0], image: { url: "attachment://" + imageFile.name } },
              embeds[1],
              embeds[2]
            ]
          }));

          response = await fetch(webhook, {
            method: "POST",
            body: formData
          });
        } else {
          response = await fetch(webhook, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              username: "EternalSMP OC Register",
              embeds: embeds
            })
          });
        }

        if (!response.ok) {
          throw new Error("Gagal mengirim ke Discord: " + (await response.text()));
        }

        // 💾 Simpan ke localStorage
        const ocEntry = {
          gamertag: data.get("gamertag"),
          ocname: data.get("ocname"),
          race: data.get("race"),
          class: data.get("class"),
          job: data.get("job"),
          role: data.get("role"),
          sifat: data.get("sifat"),
          lore: data.get("lore"),
          tujuan: data.get("tujuan")
        };
        const saved = JSON.parse(localStorage.getItem("pendaftarOCList") || "[]");
        saved.push(ocEntry);
        localStorage.setItem("pendaftarOCList", JSON.stringify(saved));

        alert("✅ Pendaftaran berhasil dikirim!");
        form.reset();
        window.scrollTo(0, 0);
      } catch (err) {
        alert("❌ Gagal mengirim ke Discord. Silakan cek koneksi atau webhook.");
        console.error(err);
      }
    }
  </script>
</body>
</html>
